<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repurchase Agreements Visualization</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Set dark background by default */
        body {
            background-color: #111827;
            margin: 0;
            min-height: 100vh;
        }
        
        /* Improve scrolling for step content */
        .step-content {
            max-height: 250px; /* Reduced height to ensure scrollability works */
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #4B5563 #1F2937;
            padding-right: 8px; /* Add padding for scrollbar */
        }
        
        .step-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .step-content::-webkit-scrollbar-track {
            background: #1F2937;
            border-radius: 8px;
        }
        
        .step-content::-webkit-scrollbar-thumb {
            background-color: #4B5563;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const RepurchaseAgreementsVisual = () => {
            const [isDarkMode, setIsDarkMode] = React.useState(true);
            const [activeTab, setActiveTab] = React.useState('process');
            const [currentStep, setCurrentStep] = React.useState(1);
            const chartRef = React.useRef(null);
            const [chart, setChart] = React.useState(null);
            const [showingExample, setShowingExample] = React.useState(false);
            const brandColor = "#079A4F"; // Brand green color

            React.useEffect(() => {
                const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
                setIsDarkMode(darkModeQuery.matches);

                const handler = (e) => setIsDarkMode(e.matches);
                darkModeQuery.addEventListener('change', handler);

                return () => darkModeQuery.removeEventListener('change', handler);
            }, []);
            
            const nextStep = () => {
                setCurrentStep(prev => prev < 4 ? prev + 1 : 1);
            };

            const prevStep = () => {
                setCurrentStep(prev => prev > 1 ? prev - 1 : 4);
            };
            // Example data for rate chart
            React.useEffect(() => {
                if (chartRef.current && activeTab === 'rates') {
                    if (chart) {
                        chart.destroy();
                    }

                    const ctx = chartRef.current.getContext('2d');
                    
                    if (showingExample) {
                        // Specific period example
                        const dates = ['Jan 2', 'Jan 3', 'Jan 4', 'Jan 5', 'Jan 8', 'Jan 9', 'Jan 10', 'Jan 11', 'Jan 12'];
                        const repoRates = [4.32, 4.40, 4.35, 4.30, 4.28, 4.25, 4.35, 4.42, 4.38];
                        const fedFundsRates = [4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50];
                        
                        const newChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: dates,
                                datasets: [
                                    {
                                        label: 'Overnight Repo Rate',
                                        data: repoRates,
                                        borderColor: '#3B82F6',
                                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                        tension: 0.2,
                                        fill: false,
                                        pointRadius: 3
                                    },
                                    {
                                        label: 'Fed Funds Rate',
                                        data: fedFundsRates,
                                        borderColor: '#FF4444',
                                        backgroundColor: 'rgba(255, 68, 68, 0.1)',
                                        tension: 0,
                                        fill: false,
                                        pointRadius: 0,
                                        borderDash: [5, 5]
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    intersect: false,
                                    mode: 'index'
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                        labels: {
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        }
                                    },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: isDarkMode ? '#374151' : 'white',
                                        titleColor: isDarkMode ? '#fff' : '#000',
                                        bodyColor: isDarkMode ? '#fff' : '#000',
                                        borderColor: isDarkMode ? '#4B5563' : '#E5E7EB',
                                        borderWidth: 1,
                                        padding: 10,
                                        displayColors: true
                                    }
                                },
                                scales: {
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'Rate (%)',
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        },
                                        grid: {
                                            color: isDarkMode ? '#374151' : '#e5e7eb'
                                        },
                                        ticks: {
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            color: isDarkMode ? '#374151' : '#e5e7eb'
                                        },
                                        ticks: {
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        }
                                    }
                                }
                            }
                        });
                        setChart(newChart);
                    } else {
                        // General comparison of different repo rates
                        const repoTypes = ['Overnight', '1-Week', '2-Week', '1-Month', '3-Month'];
                        const repoRates = [4.35, 4.42, 4.48, 4.55, 4.65];
                        
                        const newChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: repoTypes,
                                datasets: [{
                                    label: 'Repo Rates by Term',
                                    data: repoRates,
                                    backgroundColor: '#3B82F6',
                                    borderColor: 'rgba(59, 130, 246, 0.8)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: isDarkMode ? '#374151' : 'white',
                                        titleColor: isDarkMode ? '#fff' : '#000',
                                        bodyColor: isDarkMode ? '#fff' : '#000',
                                        borderColor: isDarkMode ? '#4B5563' : '#E5E7EB',
                                        borderWidth: 1,
                                        padding: 10,
                                        displayColors: false,
                                        callbacks: {
                                            label: function(context) {
                                                return `Rate: ${context.parsed.y}%`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'Rate (%)',
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        },
                                        grid: {
                                            color: isDarkMode ? '#374151' : '#e5e7eb'
                                        },
                                        ticks: {
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            color: isDarkMode ? '#374151' : '#e5e7eb'
                                        },
                                        ticks: {
                                            color: isDarkMode ? '#9CA3AF' : '#4B5563'
                                        }
                                    }
                                },
                                // Added to display values above bars
                                plugins: [{
                                    afterDraw: function(chart) {
                                        var ctx = chart.ctx;
                                        ctx.font = '12px Arial';
                                        ctx.fillStyle = '#FFF';
                                        ctx.textAlign = 'center';
                                        
                                        chart.data.datasets.forEach(function(dataset, datasetIndex) {
                                            chart.getDatasetMeta(datasetIndex).data.forEach(function(bar, index) {
                                                var value = dataset.data[index];
                                                var xPos = bar.x;
                                                var yPos = bar.y - 10;
                                                ctx.fillText(value + '%', xPos, yPos);
                                            });
                                        });
                                    }
                                }]
                            }
                        });
                        setChart(newChart);
                    }
                }
            }, [activeTab, showingExample, isDarkMode]);

            return (
                <div className="min-h-screen bg-gray-900 py-8 text-white">
                    <div className="w-full max-w-2xl mx-auto p-4">
                        <div className="rounded-lg shadow-lg p-6 bg-gray-800">
                            <h2 className="text-2xl font-bold mb-4 text-white">
                                Repurchase Agreements (Repos)
                            </h2>
                            
                            <div className="mb-6 bg-gray-700 p-4 rounded-lg">
                                <div className="text-sm text-gray-400 mb-1">Definition</div>
                                <p className="text-gray-200">
                                    Short-term borrowing arrangements (typically overnight to 14 days) where securities are sold with a simultaneous agreement to buy them back at a slightly higher price at a specific future date. Also known as "repos," these instruments are essential for short-term liquidity in financial markets.
                                </p>
                            </div>

                            <div className="mb-4 flex">
                                <button
                                    className={`px-4 py-2 ${activeTab === 'process' ? 'bg-blue-800 text-white' : 'bg-gray-700 text-gray-300'} rounded-tl-lg rounded-bl-lg`}
                                    onClick={() => setActiveTab('process')}
                                >
                                    Process
                                </button>
                                <button
                                    className={`px-4 py-2 ${activeTab === 'types' ? 'bg-blue-800 text-white' : 'bg-gray-700 text-gray-300'}`}
                                    onClick={() => setActiveTab('types')}
                                >
                                    Types
                                </button>
                                <button
                                    className={`px-4 py-2 ${activeTab === 'rates' ? 'bg-blue-800 text-white' : 'bg-gray-700 text-gray-300'}`}
                                    onClick={() => setActiveTab('rates')}
                                >
                                    Rates
                                </button>
                                <button
                                    className={`px-4 py-2 ${activeTab === 'market' ? 'bg-blue-800 text-white' : 'bg-gray-700 text-gray-300'} rounded-tr-lg rounded-br-lg`}
                                    onClick={() => setActiveTab('market')}
                                >
                                    Market Role
                                </button>
                            </div>
                            {/* Repo Process Visualization */}
                            {activeTab === 'process' && (
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-3 text-blue-400">How Repos Work</h3>
                                    
                                    <div className="relative h-80 mb-4 bg-gray-700 rounded-lg overflow-hidden">
                                        {/* Step 1: Initial Transaction */}
                                        {currentStep === 1 && (
                                            <div className="absolute inset-0 p-4">
                                                <h3 className="text-lg font-semibold mb-2 text-center text-blue-400">Step 1: Initial Transaction (Day 1)</h3>
                                                
                                                <div className="step-content p-2">
                                                    <div className="flex justify-between items-center">
                                                        <div className="bg-gray-600 p-3 rounded-lg w-1/3 text-center">
                                                            <div className="text-yellow-400 font-bold mb-2">Cash Provider</div>
                                                            <div className="text-sm mb-2">Bank, Money Market Fund, etc.</div>
                                                            <div className="text-sm">Seeking:</div>
                                                            <div className="text-xs text-gray-300">• Short-term investment</div>
                                                            <div className="text-xs text-gray-300">• Low risk</div>
                                                            <div className="text-xs text-gray-300">• Small return</div>
                                                        </div>
                                                        
                                                        <div className="w-1/4 flex flex-col items-center">
                                                            <div className="border-t-2 border-green-400 w-full"></div>
                                                            <div className="bg-green-900 text-green-400 text-xs my-1 p-1 rounded">$10,000,000 Cash</div>
                                                            <div className="border-t-2 border-green-400 w-full"></div>
                                                            <div className="my-2 text-center text-xs text-gray-300">In exchange for</div>
                                                            <div className="border-t-2 border-blue-400 w-full"></div>
                                                            <div className="bg-blue-900 text-blue-400 text-xs my-1 p-1 rounded">Treasury Securities</div>
                                                            <div className="border-t-2 border-blue-400 w-full"></div>
                                                            <div className="flex flex-col text-xs text-gray-300 items-center mb-1 text-center">
                                                                <div>Market Value: $10,200,000</div>
                                                                <div>(2% haircut for collateral)</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="bg-gray-600 p-3 rounded-lg w-1/3 text-center">
                                                            <div className="text-blue-400 font-bold mb-2">Cash Borrower</div>
                                                            <div className="text-sm mb-2">Dealer, Bank, Hedge Fund</div>
                                                            <div className="text-sm">Needs:</div>
                                                            <div className="text-xs text-gray-300">• Short-term funding</div>
                                                            <div className="text-xs text-gray-300">• Liquidity management</div>
                                                            <div className="text-xs text-gray-300">• Financing inventory</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="text-center text-xs text-gray-300 mt-4">
                                                        Agreement: Borrower will repurchase securities in 7 days at $10,010,000 (0.4% repo rate)
                                                    </div>
                                                    
                                                    <div className="bg-gray-600 p-3 rounded-lg mt-3">
                                                        <p className="text-xs text-gray-300">
                                                            <span className="font-semibold text-blue-400">Note on "Haircut":</span> In repo transactions, a haircut is the difference between the market value of the asset and the amount loaned against it. This provides a safety margin for the cash provider. If the borrower defaults, the lender has collateral worth more than the loan amount to protect against market fluctuations.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Step 2: During the Term */}
                                        {currentStep === 2 && (
                                            <div className="absolute inset-0 p-4">
                                                <h3 className="text-lg font-semibold mb-2 text-center text-blue-400">Step 2: During the Term (Days 1-7)</h3>
                                                
                                                <div className="step-content p-2">
                                                    <div className="flex justify-between">
                                                        <div className="bg-gray-600 p-3 rounded-lg w-5/12 flex flex-col">
                                                            <div className="text-yellow-400 font-bold mb-2 text-center">Cash Provider</div>
                                                            <div className="text-sm mb-2 text-center">Status During Term:</div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded mb-2">
                                                                <div className="text-sm font-semibold">Collateral Ownership</div>
                                                                <div className="text-xs text-gray-300">Legal owner of securities</div>
                                                            </div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded mb-2">
                                                                <div className="text-sm font-semibold">Collateral Protection</div>
                                                                <div className="text-xs text-gray-300">Secured in case borrower defaults</div>
                                                            </div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded">
                                                                <div className="text-sm font-semibold">Limited Rights</div>
                                                                <div className="text-xs text-gray-300">Can't sell/transfer securities unless borrower defaults</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="bg-gray-600 p-3 rounded-lg w-5/12 flex flex-col">
                                                            <div className="text-blue-400 font-bold mb-2 text-center">Cash Borrower</div>
                                                            <div className="text-sm mb-2 text-center">Status During Term:</div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded mb-2">
                                                                <div className="text-sm font-semibold">Uses Cash</div>
                                                                <div className="text-xs text-gray-300">For short-term funding needs</div>
                                                            </div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded mb-2">
                                                                <div className="text-sm font-semibold">Economic Ownership</div>
                                                                <div className="text-xs text-gray-300">Still receives interest, coupons from securities</div>
                                                            </div>
                                                            
                                                            <div className="bg-gray-700 p-2 rounded">
                                                                <div className="text-sm font-semibold">Market Risk</div>
                                                                <div className="text-xs text-gray-300">Remains exposed to market value changes of securities</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="text-center text-xs text-gray-300 mt-4">
                                                        The repo is effectively a collateralized loan, though structured as a sale and repurchase
                                                    </div>
                                                    
                                                    <div className="bg-gray-600 p-3 rounded-lg mt-3">
                                                        <p className="text-xs text-gray-300">
                                                            <span className="font-semibold text-blue-400">Repo Mechanics:</span> While legally structured as a sale and repurchase, economically a repo functions like a secured loan. The cash borrower retains economic benefits of the securities (dividends, coupons) but the cash lender has legal ownership as protection against default.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Step 3: Repurchase */}
                                        {currentStep === 3 && (
                                            <div className="absolute inset-0 p-4">
                                                <h3 className="text-lg font-semibold mb-2 text-center text-blue-400">Step 3: Repurchase (Day 7)</h3>
                                                
                                                <div className="step-content p-2">
                                                    <div className="flex justify-between items-center">
                                                        <div className="bg-gray-600 p-3 rounded-lg w-1/3 text-center">
                                                            <div className="text-yellow-400 font-bold mb-2">Cash Provider</div>
                                                            <div className="text-sm mb-2">Returns Securities</div>
                                                            <div className="bg-yellow-800 bg-opacity-50 mx-auto w-20 h-20 rounded-full flex items-center justify-center">
                                                                <div className="text-center">
                                                                    <div className="text-xs">Earned</div>
                                                                    <div className="text-sm">$10,000</div>
                                                                    <div className="text-xs">(0.4% for 7 days)</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="w-1/4 flex flex-col items-center">
                                                            <div className="border-t-2 border-blue-400 w-full"></div>
                                                            <div className="bg-blue-900 text-blue-400 text-xs my-1 p-1 rounded">Return Securities</div>
                                                            <div className="border-t-2 border-blue-400 w-full"></div>
                                                            <div className="my-2 text-center text-xs text-gray-300">In exchange for</div>
                                                            <div className="border-t-2 border-green-400 w-full"></div>
                                                            <div className="bg-green-900 text-green-400 text-xs my-1 p-1 rounded">$10,010,000</div>
                                                            <div className="border-t-2 border-green-400 w-full"></div>
                                                            <div className="flex flex-col text-xs text-gray-300 items-center mb-1 text-center">
                                                                <div>Original $10M + interest</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="bg-gray-600 p-3 rounded-lg w-1/3 text-center">
                                                            <div className="text-blue-400 font-bold mb-2">Cash Borrower</div>
                                                            <div className="text-sm mb-2">Repurchases Securities</div>
                                                            <div className="bg-blue-800 bg-opacity-50 mx-auto w-20 h-20 rounded-full flex items-center justify-center">
                                                                <div className="text-center">
                                                                    <div className="text-xs">Paid</div>
                                                                    <div className="text-sm">$10,000</div>
                                                                    <div className="text-xs">for 7-day funding</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="text-center text-xs text-gray-300 mt-4">
                                                        Transaction is completed; each party has fulfilled their contractual obligations
                                                    </div>
                                                    
                                                    <div className="bg-gray-600 p-3 rounded-lg mt-3">
                                                        <p className="text-xs text-gray-300">
                                                            <span className="font-semibold text-blue-400">Settlement Process:</span> On the maturity date, the original cash amount plus agreed-upon interest is returned to the cash provider, and legal ownership of the securities reverts to the original owner. This completes the repo cycle, though many institutions will roll over (renew) their repos regularly.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Step 4: Default Scenario */}
                                        {currentStep === 4 && (
                                            <div className="absolute inset-0 p-4">
                                                <h3 className="text-lg font-semibold mb-2 text-center text-blue-400">Alternative: Default Scenario</h3>
                                                
                                                <div className="step-content p-2">
                                                    <div className="text-center text-sm mb-2 text-red-400">If the borrower fails to repurchase the securities:</div>
                                                    
                                                    <div className="grid grid-cols-3 gap-3 mb-4">
                                                        <div className="bg-gray-600 p-2 rounded-lg text-center">
                                                            <div className="font-semibold text-sm text-red-400 mb-1">1. Default Triggered</div>
                                                            <div className="text-xs text-gray-300">Cash provider not required to return securities</div>
                                                        </div>
                                                        <div className="bg-gray-600 p-2 rounded-lg text-center">
                                                            <div className="font-semibold text-sm text-red-400 mb-1">2. Collateral Ownership</div>
                                                            <div className="text-xs text-gray-300">Provider already has legal title to securities</div>
                                                        </div>
                                                        <div className="bg-gray-600 p-2 rounded-lg text-center">
                                                            <div className="font-semibold text-sm text-red-400 mb-1">3. Market Sale</div>
                                                            <div className="text-xs text-gray-300">Provider can sell securities to recover funds</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-gray-600 p-3 rounded-lg mb-3">
                                                        <div className="text-center font-semibold text-sm mb-2">Risk Protection Mechanisms</div>
                                                        <div className="grid grid-cols-2 gap-2">
                                                            <div className="bg-gray-700 p-2 rounded-lg">
                                                                <div className="text-sm font-semibold">Haircut</div>
                                                                <div className="text-xs text-gray-300">2% discount on collateral value provides buffer against market value declines</div>
                                                            </div>
                                                            <div className="bg-gray-700 p-2 rounded-lg">
                                                                <div className="text-sm font-semibold">Margin Calls</div>
                                                                <div className="text-xs text-gray-300">If security value drops during term, borrower may need to post additional collateral</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex justify-center mb-3">
                                                        <div className="bg-red-900 bg-opacity-30 px-4 py-2 rounded-lg text-center">
                                                            <div className="text-sm">This is why repo transactions are considered low-risk for cash providers</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-gray-600 p-3 rounded-lg">
                                                        <p className="text-xs text-gray-300">
                                                            <span className="font-semibold text-blue-400">Default Handling:</span> The repos' legal structure as a sale/repurchase transaction (rather than a loan) provides significant protection to the cash provider. Unlike a standard secured loan that would require foreclosure proceedings, the cash provider already owns the collateral and can immediately sell it to recover funds if needed.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex justify-between">
                                        <button 
                                            onClick={prevStep}
                                            className="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors"
                                        >
                                            Previous
                                        </button>
                                        <div className="flex space-x-2">
                                            {[1, 2, 3, 4].map(i => (
                                                <div 
                                                    key={i}
                                                    className={`w-2 h-2 rounded-full ${currentStep === i ? 'bg-blue-500' : 'bg-gray-500'}`}
                                                    onClick={() => setCurrentStep(i)}
                                                ></div>
                                            ))}
                                        </div>
                                        <button 
                                            onClick={nextStep}
                                            className="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors"
                                        >
                                            Next
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Repo Types */}
                            {activeTab === 'types' && (
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-3 text-blue-400">Types of Repo Agreements</h3>
                                    
                                    <div className="grid grid-cols-1 gap-4 mb-4">
                                        <div className="bg-gray-700 p-4 rounded-lg">
                                            <h4 className="font-semibold text-green-400 mb-2">By Term Structure</h4>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div className="bg-gray-800 p-3 rounded-lg">
                                                    <div className="text-blue-400 font-semibold mb-1">Overnight Repo</div>
                                                    <div className="text-xs text-gray-300 mb-2">Matures the next business day</div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Advantages:</span> Maximum liquidity, minimal interest rate risk
                                                    </div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Use Case:</span> Daily cash management
                                                    </div>
                                                </div>
                                                <div className="bg-gray-800 p-3 rounded-lg">
                                                    <div className="text-blue-400 font-semibold mb-1">Term Repo</div>
                                                    <div className="text-xs text-gray-300 mb-2">Fixed term (typically 1 day to 3 months)</div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Advantages:</span> Predictable funding, locked-in rate
                                                    </div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Use Case:</span> Medium-term funding needs
                                                    </div>
                                                </div>
                                                <div className="bg-gray-800 p-3 rounded-lg">
                                                    <div className="text-blue-400 font-semibold mb-1">Open Repo</div>
                                                    <div className="text-xs text-gray-300 mb-2">No fixed maturity date; continues until terminated</div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Advantages:</span> Flexibility for both parties
                                                    </div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Use Case:</span> Uncertain timeframe funding
                                                    </div>
                                                </div>
                                                <div className="bg-gray-800 p-3 rounded-lg">
                                                    <div className="text-blue-400 font-semibold mb-1">Evergreen Repo</div>
                                                    <div className="text-xs text-gray-300 mb-2">Automatically rolls over unless terminated</div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Advantages:</span> Reduced administrative burden
                                                    </div>
                                                    <div className="text-xs">
                                                        <span className="font-semibold">Use Case:</span> Ongoing funding relationships
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 gap-4 mb-4">
                                        <div className="bg-gray-700 p-4 rounded-lg">
                                            <h4 className="font-semibold text-amber-400 mb-2">By Transaction Structure</h4>
                                            <div className="space-y-3">
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-amber-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Bilateral Repo</span>
                                                        <p className="text-gray-300 text-xs">Direct transaction between two parties. Involves negotiation on terms and credit risk assessment of counterparty.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-amber-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Tri-Party Repo</span>
                                                        <p className="text-gray-300 text-xs">Involves a third-party agent (usually a clearing bank) that facilitates the transaction by providing collateral management, valuation, and settlement services.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-amber-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Hold-in-Custody Repo</span>
                                                        <p className="text-gray-300 text-xs">The seller/borrower retains possession of the collateral but segregates it on behalf of the buyer. Less common due to higher counterparty risk.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-amber-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Specialized Repo</span>
                                                        <p className="text-gray-300 text-xs">Used to obtain specific securities rather than cash. Often used when a security is in high demand or hard to borrow.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-700 p-4 rounded-lg">
                                        <h4 className="font-semibold text-purple-400 mb-2">By Collateral Type</h4>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="bg-gray-800 p-3 rounded-lg">
                                                <div className="text-purple-400 font-semibold mb-1">Government Securities</div>
                                                <div className="text-xs mb-1">
                                                    <span className="font-semibold">Examples:</span> Treasury bonds, notes, bills
                                                </div>
                                                <div className="text-xs">
                                                    <span className="font-semibold">Features:</span> Lowest haircuts, highest liquidity, zero risk weight
                                                </div>
                                            </div>
                                            <div className="bg-gray-800 p-3 rounded-lg">
                                                <div className="text-purple-400 font-semibold mb-1">Agency Securities</div>
                                                <div className="text-xs mb-1">
                                                    <span className="font-semibold">Examples:</span> Fannie Mae, Freddie Mac securities
                                                </div>
                                                <div className="text-xs">
                                                    <span className="font-semibold">Features:</span> Low haircuts, good liquidity, low risk weight
                                                </div>
                                            </div>
                                            <div className="bg-gray-800 p-3 rounded-lg">
                                                <div className="text-purple-400 font-semibold mb-1">Corporate Bonds</div>
                                                <div className="text-xs mb-1">
                                                    <span className="font-semibold">Examples:</span> Investment-grade corporate debt
                                                </div>
                                                <div className="text-xs">
                                                    <span className="font-semibold">Features:</span> Higher haircuts, moderate liquidity, higher risk weights
                                                </div>
                                            </div>
                                            <div className="bg-gray-800 p-3 rounded-lg">
                                                <div className="text-purple-400 font-semibold mb-1">Equity Securities</div>
                                                <div className="text-xs mb-1">
                                                    <span className="font-semibold">Examples:</span> Stocks, ETFs
                                                </div>
                                                <div className="text-xs">
                                                    <span className="font-semibold">Features:</span> Highest haircuts, variable liquidity, highest risk weights
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Repo Rates */}
                            {activeTab === 'rates' && (
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-3 text-blue-400">Repo Rates & Pricing</h3>
                                    
                                    <div className="flex mb-4">
                                        <button
                                            className={`px-4 py-2 rounded-tl-lg rounded-bl-lg ${!showingExample ? 'bg-gray-700 text-white' : 'bg-gray-600 text-gray-300'}`}
                                            onClick={() => setShowingExample(false)}
                                        >
                                            Rate Structure
                                        </button>
                                        <button
                                            className={`px-4 py-2 rounded-tr-lg rounded-br-lg ${showingExample ? 'bg-gray-700 text-white' : 'bg-gray-600 text-gray-300'}`}
                                            onClick={() => setShowingExample(true)}
                                        >
                                            Rate Trends
                                        </button>
                                    </div>

                                    <div className="h-64 mb-2">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                    
                                    {/* Chart explanation box */}
                                    <div className="bg-gray-600 p-3 rounded-lg mb-4">
                                        <p className="text-xs text-gray-300">
                                            {showingExample ? 
                                                <span>
                                                    <span className="font-semibold text-blue-400">Chart Explanation:</span> This chart illustrates the daily fluctuation of overnight repo rates (blue line) compared to the Federal Reserve's target rate (red dashed line) over a sample period. Note how repo rates typically trade below the Fed Funds rate but can experience volatility due to market liquidity conditions, quarter-end balance sheet constraints, and other technical factors.
                                                </span>
                                                : 
                                                <span>
                                                    <span className="font-semibold text-blue-400">Chart Explanation:</span> This chart shows how repo rates increase with longer terms, reflecting the increased interest rate risk and reduced liquidity of longer-dated repos. The upward sloping structure is typical in normal market conditions, though it can flatten or invert during periods of financial stress or when the market anticipates rate cuts. Rate percentages are displayed above each bar.
                                                </span>
                                            }
                                        </p>
                                    </div>

                                    <div className="bg-gray-700 p-4 rounded-lg">
                                        <h4 className="font-semibold text-md mb-2 text-blue-400">
                                            {showingExample ? "Repo Rate Drivers" : "Repo Rate Components"}
                                        </h4>
                                        
                                        {showingExample ? (
                                            <div className="space-y-2">
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Federal Reserve Policy:</span> The Fed Funds target rate provides the baseline for repo rates. Changes in monetary policy directly impact repo markets.
                                                    </p>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Market Liquidity:</span> When cash is abundant, repo rates tend to fall. Conversely, cash scarcity drives rates higher.
                                                    </p>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Quarter/Year-End Effects:</span> Rates often spike at reporting periods as financial institutions adjust balance sheets for regulatory compliance.
                                                    </p>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-2">
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Term Premium:</span> Longer-term repos typically command higher rates to compensate for increased interest rate risk and reduced liquidity.
                                                    </p>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Collateral Quality:</span> Less liquid or lower credit quality collateral requires higher repo rates. Treasury securities typically receive the best rates.
                                                    </p>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <p className="text-gray-200 text-sm">
                                                        <span className="font-semibold">Counterparty Risk:</span> Transactions with higher-rated institutions generally receive more favorable rates.
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Market Role */}
                            {activeTab === 'market' && (
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-3 text-blue-400">Market Role & Significance</h3>
                                    
                                    <div className="grid grid-cols-1 gap-4 mb-4">
                                        <div className="bg-gray-700 p-4 rounded-lg">
                                            <h4 className="font-semibold text-green-400 mb-2">Function in Financial Markets</h4>
                                            <div className="space-y-3">
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-green-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Liquidity Management</span>
                                                        <p className="text-gray-300 text-xs">Banks and financial institutions use repos to manage short-term cash positions, addressing temporary surpluses or shortfalls.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-green-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Dealer Financing</span>
                                                        <p className="text-gray-300 text-xs">Securities dealers fund their inventories through repo markets, enabling market-making activities in bonds and other securities.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-green-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Monetary Policy Implementation</span>
                                                        <p className="text-gray-300 text-xs">Central banks use repos to implement monetary policy and inject or absorb liquidity from the banking system.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start">
                                                    <div className="w-3 h-3 rounded-full bg-green-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                    <div>
                                                        <span className="font-semibold">Safe Investment</span>
                                                        <p className="text-gray-300 text-xs">Money market funds and other investors use repos as low-risk, short-term investments that preserve capital while earning interest.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div className="bg-gray-700 p-4 rounded-lg">
                                            <h4 className="font-semibold text-amber-400 mb-2">Market Participants</h4>
                                            <div className="space-y-2">
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Primary Dealers</span>
                                                    <div className="text-xs text-gray-300 mt-1">Major banks and broker-dealers that trade directly with central banks</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Central Banks</span>
                                                    <div className="text-xs text-gray-300 mt-1">Federal Reserve, ECB, Bank of England, etc.</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Money Market Funds</span>
                                                    <div className="text-xs text-gray-300 mt-1">Major cash providers in the repo market</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Hedge Funds</span>
                                                    <div className="text-xs text-gray-300 mt-1">Use repos to finance leveraged positions</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-700 p-4 rounded-lg">
                                            <h4 className="font-semibold text-purple-400 mb-2">Market Size & Volume</h4>
                                            <div className="space-y-2">
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">U.S. Repo Market</span>
                                                    <div className="text-xs text-gray-300 mt-1">Approximately $4+ trillion in daily trading volume</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">European Repo Market</span>
                                                    <div className="text-xs text-gray-300 mt-1">Approximately €8+ trillion outstanding</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Tri-Party Share</span>
                                                    <div className="text-xs text-gray-300 mt-1">Over 60% of U.S. repo market uses tri-party format</div>
                                                </div>
                                                <div className="bg-gray-800 p-2 rounded-lg text-sm">
                                                    <span className="font-semibold">Growth Trend</span>
                                                    <div className="text-xs text-gray-300 mt-1">Steadily expanding since 2008 financial crisis reforms</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-700 p-4 rounded-lg">
                                        <h4 className="font-semibold text-blue-400 mb-2">Systemic Importance</h4>
                                        <div className="space-y-3">
                                            <div className="flex items-start">
                                                <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                <p className="text-gray-200 text-sm">
                                                    <span className="font-semibold">Financial Stability Indicator:</span> Disruptions in repo markets can signal broader financial system stress. Repo rates spiking above normal ranges often indicate liquidity or counterparty concerns.
                                                </p>
                                            </div>
                                            <div className="flex items-start">
                                                <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                <p className="text-gray-200 text-sm">
                                                    <span className="font-semibold">Crisis Vulnerability:</span> The 2008 financial crisis and September 2019 repo market spike demonstrated how critical these markets are. Reforms since 2008 have aimed to reduce systemic risk.
                                                </p>
                                            </div>
                                            <div className="flex items-start">
                                                <div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 mr-2 flex-shrink-0"></div>
                                                <p className="text-gray-200 text-sm">
                                                    <span className="font-semibold">Regulatory Oversight:</span> Enhanced monitoring and regulation after 2008, including Basel III liquidity requirements and central clearing initiatives for certain repo transactions.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="mt-6 bg-gray-700 p-4 rounded-lg">
                                <div className="font-semibold mb-2 text-gray-300">Key Repo Terms</div>
                                <div className="grid grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span className="font-semibold">Haircut:</span> 
                                        <p className="text-gray-300">Discount applied to security's market value (typically 1-5%)</p>
                                    </div>
                                    <div>
                                        <span className="font-semibold">Repo Rate:</span> 
                                        <p className="text-gray-300">Annualized interest rate on the cash loan component</p>
                                    </div>
                                    <div>
                                        <span className="font-semibold">Margin Call:</span> 
                                        <p className="text-gray-300">Request for additional collateral if value falls below threshold</p>
                                    </div>
                                    <div>
                                        <span className="font-semibold">Reverse Repo:</span> 
                                        <p className="text-gray-300">Same transaction viewed from cash provider's perspective</p>
                                    </div>
                                    <div>
                                        <span className="font-semibold">GC Repo:</span> 
                                        <p className="text-gray-300">General Collateral repo where any securities in a class are acceptable</p>
                                    </div>
                                    <div>
                                        <span className="font-semibold">Special Repo:</span> 
                                        <p className="text-gray-300">Transaction for specific security that's in high demand</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RepurchaseAgreementsVisual />);
    </script>
</body>
</html>